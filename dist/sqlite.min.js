(function(){var v;var b;var _;htmx.defineExtension("sqlite",{init:function(e){v=e;b={maxPageSize:4096,timeout:1e4,cacheSize:4096};_={rowMode:"object"}},onEvent:function(e,a){if(e==="htmx:beforeRequest"){let r=a.detail.elt;var t=a.detail.requestConfig;var s;if(t.path==="this.value"||t.verb.toUpperCase()==="GET"&&t.path.toUpperCase().startsWith("SELECT ")||t.verb.toUpperCase()==="PUT"&&t.path.toUpperCase().startsWith("UPDATE ")||t.verb.toUpperCase()==="DELETE"&&t.path.toUpperCase().startsWith("DELETE ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("INSERT ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("ALTER ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("CREATE ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("DROP ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("TRUNCATE ")){s=t.path}else{return true}if(s==="this.value"){s=r.value;if(!a.detail.target){throw new Error("Attribute 'hx-target' is required when value is used is empty")}}var i=htmx.closest(r,"[hx-db]");if(!i){throw new Error("Attribute 'hx-db' is required in the ancestor hierarchy")}var n=i.getAttribute("hx-db");var h=a.detail.xhr.onload;var p=a.detail.xhr.onerror;a.detail.xhr={status:200,getAllResponseHeaders:function(){return"Content-Type:application/json"},getResponseHeader:function(e){if(e.toLowerCase()==="content-type"){return"application/json"}return undefined}};var o={};Object.entries(a.detail.requestConfig.parameters).forEach(function([e,t]){o["$"+e]=t});var l=htmx.closest(r,"[hx-request]");var c=l?JSON.parse(l.getAttribute("hx-request")):{};var d={...b,..._,...c};var u=htmx.closest(r,"[hx-db],[hx-request]");var x;if(u._htmx_sqlite_http_backend){x=u._htmx_sqlite_http_backend}else{x=n.match(/^https?:/)?{http:sqliteWasmHttp.createHttpBackend(d)}:{};u._htmx_sqlite_http_backend=x}u.addEventListener("htmx:beforeCleanupElement",function(e){if(e.detail.elt==u&&u._htmx_sqlite_http_backend&&u._htmx_sqlite_http_backend.http){u._htmx_sqlite_http_backend.http.close();delete u._htmx_sqlite_http_backend}});var f=[];sqliteWasmHttp.createSQLiteThread(x).then(function(e){e("open",{filename:encodeURI(n.match(/^https?:\/\//)?n:n.replace(/^opfs:/,"").replace(/^https?:/,"file:")),vfs:n.replace(/:.*/,"").replace("https","http")});return e}).then(function(t){v.triggerEvent(r,"htmx:xhr:loadstart",{elt:r,xhr:{...a.detail.xhr,db:t}});t("exec",{sql:s,bind:o,rowMode:d.rowMode,callback:function(e){if(e.row){f.push(e.row);v.triggerEvent(r,"htmx:xhr:progress",{elt:r,xhr:{...a.detail.xhr,db:t,response:JSON.stringify(e.row),responseJSON:e.row}})}else{v.triggerEvent(r,"htmx:xhr:loadend",{elt:r,xhr:{...a.detail.xhr,db:t,response:f.length==0?"":JSON.stringify(f),responseJSON:f}});t("close",{}).then(function(){t.close()});a.detail.xhr.responseJSON=f;a.detail.xhr.response=JSON.stringify(f);h()}}}).catch(function(e){if(e.result){a.detail.error=e.result.message}p()})});return false}}})})();