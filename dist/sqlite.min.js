(function(){var f;var v;var b;htmx.defineExtension("sqlite",{init:function(e){f=e;v={maxPageSize:4096,timeout:1e4,cacheSize:4096};b={rowMode:"object"}},onEvent:function(e,a){if(e==="htmx:beforeRequest"){let r=a.detail.elt;var t=a.detail.requestConfig;var s;if(t.path==="this.value"||t.verb.toUpperCase()==="GET"&&t.path.toUpperCase().startsWith("SELECT ")||t.verb.toUpperCase()==="PUT"&&t.path.toUpperCase().startsWith("UPDATE ")||t.verb.toUpperCase()==="DELETE"&&t.path.toUpperCase().startsWith("DELETE ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("INSERT ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("ALTER ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("CREATE ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("DROP ")||t.verb.toUpperCase()==="POST"&&t.path.toUpperCase().startsWith("TRUNCATE ")){s=t.path}else{return true}if(s==="this.value"){s=r.value;if(!a.detail.target){throw new Error("Attribute 'hx-target' is required when value is used is empty")}}var i=htmx.closest(r,"[hx-db]");if(!i){throw new Error("Attribute 'hx-db' is required in the ancestor hierarchy")}var n=i.getAttribute("hx-db");var h=a.detail.xhr.onload;var p=a.detail.xhr.onerror;a.detail.xhr={status:200,getAllResponseHeaders:function(){return"Content-Type:application/json"},getResponseHeader:function(e){if(e.toLowerCase()==="content-type"){return"application/json"}return undefined}};var o={};Object.entries(a.detail.requestConfig.parameters).forEach(function([e,t]){o["$"+e]=t});var l=htmx.closest(r,"[hx-request]");var c=l?JSON.parse(l.getAttribute("hx-request")):{};var d={...v,...b,...c};var u;if(i._htmx_sqlite_http_backend){u=i._htmx_sqlite_http_backend}else{u=n.match(/^https?:/)?{http:sqliteWasmHttp.createHttpBackend(d)}:{};i._htmx_sqlite_http_backend=u}i.addEventListener("htmx:beforeCleanupElement",function(e){if(e.detail.elt==i&&i._htmx_sqlite_http_backend&&i._htmx_sqlite_http_backend.http){i._htmx_sqlite_http_backend.http.close();delete i._htmx_sqlite_http_backend}});var x=[];sqliteWasmHttp.createSQLiteThread(u).then(function(e){e("open",{filename:encodeURI(n.match(/^https?:\/\//)?n:n.replace(/^opfs:/,"").replace(/^https?:/,"file:")),vfs:n.replace(/:.*/,"").replace("https","http")});return e}).then(function(t){f.triggerEvent(r,"htmx:xhr:loadstart",{elt:r,xhr:{...a.detail.xhr,db:t}});t("exec",{sql:s,bind:o,rowMode:d.rowMode,callback:function(e){if(e.row){x.push(e.row);f.triggerEvent(r,"htmx:xhr:progress",{elt:r,xhr:{...a.detail.xhr,db:t,response:JSON.stringify(e.row),responseJSON:e.row}})}else{f.triggerEvent(r,"htmx:xhr:loadend",{elt:r,xhr:{...a.detail.xhr,db:t,response:x.length==0?"":JSON.stringify(x),responseJSON:x}});t("close",{}).then(function(){t.close()});a.detail.xhr.responseJSON=x;a.detail.xhr.response=JSON.stringify(x);h()}}}).catch(function(e){if(e.result){a.detail.error=e.result.message}p()})});return false}}})})();